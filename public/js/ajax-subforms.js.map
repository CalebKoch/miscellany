{"version":3,"file":"/js/ajax-subforms.js","mappings":"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","sources":["webpack:///./resources/assets/js/ajax-subforms.js"],"sourcesContent":["/**\n * Contains standard ajax process for forms.\n *\n * Wartning /!\\ : This will replace submit events on the form itself!\n * Usage: <form> tag must have class : 'ajax-subforms'\n *        Submit button or button group must be enclosed in a <div> that has the class : 'submit-group'\n */\nvar currentAjaxForm;\n$(document).ready(function () {\n    initSubforms();\n\n    $(document).on('shown.bs.modal shown.bs.popover', function () {\n        initSubforms();\n    });\n});\n\nfunction initSubforms() {\n    //console.info('Init Ajax Subforms');\n\n    let subForms = $('.ajax-subform');\n    if (subForms.length === 0) {\n        //console.info('not ajax subforms');\n        return;\n    }\n    //remove current submit event just in case it isn't clear\n    subForms.off('submit');\n    subForms.on('submit', function (e) {\n        //console.log('Ajax subform submitted', $(this));\n        //Get the validity status of the form\n        let formIsValid = $(this).attr('is-valid');\n        //console.log(\"Form validity\", formIsValid);\n        if (formIsValid) {\n            //console.log(\"Ajax subform already validated, sending\", $(this));\n            //do nothing and send form\n            return true;\n        }\n        //else form is not confirmed valid\n\n        //disable global alert when redirection occurs\n        window.entityFormHasUnsavedChanges = false;\n        e.preventDefault();\n\n        //show button animation\n        currentAjaxForm = $(this);\n        currentAjaxForm.find('.submit-group').hide();\n        currentAjaxForm.find('.submit-animation').show();\n\n        //send request to server\n        let formData = new FormData(this);\n        $.ajax({\n            url: $(this).attr('action'),\n            method: $(this).attr('method'),\n            data: formData,\n            cache: false,\n            contentType: false,\n            processData: false,\n            async: false\n        }).done(function () {\n            // If the validation succeeded, confirm its validity\n            currentAjaxForm.attr('is-valid', true);\n            currentAjaxForm.off('submit');\n            //console.log('form is valid?', currentAjaxForm, currentAjaxForm.attr('is-valid'));\n            // resubmit the form\n            currentAjaxForm.submit();\n        }).fail(function (err) {\n            //console.log('error', err);\n            // Reset any error fields\n            currentAjaxForm.find('.input-error').removeClass('input-error');\n            currentAjaxForm.find('.text-danger').remove();\n\n            // /?\\ how do the 503/403 error ids work ?\n            // If we have a 503 error status, let's assume it's from cloudflare and help the user\n            // properly save their data.\n            if (err.status === 503) {\n                window.showToast(err.responseJSON.message, 'toast-error');\n                resetSubformSubmitAnimation(currentAjaxForm);\n                return;\n            }\n\n            // If it's 403, the session is gone\n            if (err.status === 403) {\n                $('#entity-form-403-error').show();\n                resetSubformSubmitAnimation(currentAjaxForm);\n            }\n\n            // Loop through the errors to add the class and error message\n            let errors = err.responseJSON.errors;\n\n            let errorKeys = Object.keys(errors);\n            let foundAllErrors = true;\n            errorKeys.forEach(function (i) {\n                let errorSelector = $('[name=\"' + i + '\"]');\n                //console.log('error field', '[name=\"' + i + '\"]');\n                if (errorSelector.length > 0) {\n                    currentAjaxForm.find('[name=\"' + i + '\"]').addClass('input-error')\n                        .parent()\n                        .append('<div class=\"text-danger\">' + errors[i][0] + '</div>');\n                } else {\n                    foundAllErrors = false;\n                }\n            });\n\n            let firstItem = Object.keys(errors)[0];\n            let firstItemDom = currentAjaxForm.find('[name=\"' + firstItem + '\"]');\n\n            // If we can actually find the first element, switch to it and the correct tab.\n            if (firstItemDom.length > 0) {\n                firstItemDom.focus();\n            }\n\n            // Reset submit buttons\n            resetSubformSubmitAnimation(currentAjaxForm);\n        });\n    });\n}\n\nfunction resetSubformSubmitAnimation(form) {\n    //console.log(\"Resetting ajax subform animation\");\n    //reset animation\n    form.find('.submit-group').show();\n    form.find('.submit-animation').hide();\n}\n"],"names":["currentAjaxForm","$","document","ready","initSubforms","on","subForms","length","off","e","formIsValid","attr","window","entityFormHasUnsavedChanges","preventDefault","find","hide","show","formData","FormData","ajax","url","method","data","cache","contentType","processData","async","done","submit","fail","err","removeClass","remove","status","showToast","responseJSON","message","resetSubformSubmitAnimation","errors","errorKeys","Object","keys","foundAllErrors","forEach","i","errorSelector","addClass","parent","append","firstItem","firstItemDom","focus","form"],"sourceRoot":""}