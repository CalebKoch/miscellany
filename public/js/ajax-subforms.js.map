{"version":3,"file":"/js/ajax-subforms.js","mappings":"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","sources":["webpack:///./resources/assets/js/ajax-subforms.js"],"sourcesContent":["/**\n * Contains standard ajax process for forms.\n *\n * Wartning /!\\ : This will replace submit events on the form itself!\n * Usage: <form> tag must have class : 'ajax-subforms'\n *        Submit button or button group must be enclosed in a <div> that has the class : 'submit-group'\n */\nvar currentAjaxForm;\n$(document).ready(function () {\n    initSubforms();\n\n    $(document).on('shown.bs.modal shown.bs.popover', function () {\n        initSubforms();\n    });\n});\n\nfunction initSubforms() {\n    //console.info('Init Ajax Subforms');\n\n    let subForms = $('.ajax-subform');\n    if (subForms.length === 0) {\n        //console.info('not ajax subforms');\n        return;\n    }\n    //remove current submit event just in case it isn't clear\n    subForms.off('submit');\n    subForms.on('submit', function (e) {\n        //console.log('Ajax subform submitted', $(this));\n        //Get the validity status of the form\n        let formIsValid = $(this).attr('is-valid');\n        //console.log(\"Form validity\", formIsValid);\n        if (formIsValid) {\n            //console.log(\"Ajax subform already validated, sending\", $(this));\n            //do nothing and send form\n            return true;\n        }\n        //else form is not confirmed valid\n\n        //disable global alert when redirection occurs\n        window.entityFormHasUnsavedChanges = false;\n        e.preventDefault();\n\n        //show button animation\n        currentAjaxForm = $(this);\n        currentAjaxForm.find('.submit-group').hide();\n        currentAjaxForm.find('.submit-animation').show();\n\n        //send request to server\n        let formData = new FormData(this);\n        $.ajax({\n            url: $(this).attr('action'),\n            method: $(this).attr('method'),\n            data: formData,\n            cache: false,\n            contentType: false,\n            processData: false,\n            async: false\n        }).done(function () {\n            // If the validation succeeded, confirm its validity\n            currentAjaxForm.attr('is-valid', true);\n            currentAjaxForm.off('submit');\n            //console.log('form is valid?', currentAjaxForm, currentAjaxForm.attr('is-valid'));\n            // resubmit the form\n            currentAjaxForm.submit();\n        }).fail(function (err) {\n            //console.log('error', err);\n            // Reset any error fields\n            currentAjaxForm.find('.input-error').removeClass('input-error');\n            currentAjaxForm.find('.text-danger').remove();\n\n            // /?\\ how do the 503/403 error ids work ?\n            // If we have a 503 error status, let's assume it's from cloudflare and help the user\n            // properly save their data.\n            if (err.status === 503) {\n                window.showToast(err.responseJSON.message, 'toast-error');\n                resetSubformSubmitAnimation(currentAjaxForm);\n                return;\n            }\n\n            // If it's 403, the session is gone\n            if (err.status === 403) {\n                $('#entity-form-403-error').show();\n                resetSubformSubmitAnimation(currentAjaxForm);\n            }\n\n            // Loop through the errors to add the class and error message\n            let errors = err.responseJSON.errors;\n\n            let errorKeys = Object.keys(errors);\n            let foundAllErrors = true;\n            errorKeys.forEach(function (i) {\n                let errorSelector = $('[name=\"' + i + '\"]');\n                //console.log('error field', '[name=\"' + i + '\"]');\n                if (errorSelector.length > 0) {\n                    currentAjaxForm.find('[name=\"' + i + '\"]').addClass('input-error')\n                        .parent()\n                        .append('<div class=\"text-danger\">' + errors[i][0] + '</div>');\n                } else {\n                    foundAllErrors = false;\n                }\n            });\n\n            let firstItem = Object.keys(errors)[0];\n            let firstItemDom = currentAjaxForm.find('[name=\"' + firstItem + '\"]');\n\n            // If we can actually find the first element, switch to it and the correct tab.\n            if (firstItemDom.length > 0) {\n                firstItemDom.focus();\n            }\n\n            // Reset submit buttons\n            resetSubformSubmitAnimation(currentAjaxForm);\n        });\n    });\n}\n\nfunction resetSubformSubmitAnimation(form) {\n    //console.log(\"Resetting ajax subform animation\");\n    //reset animation\n    form.find('.submit-group').show();\n    form.find('.submit-animation').hide();\n}\n"],"names":["currentAjaxForm","$","document","ready","initSubforms","on","subForms","length","off","e","formIsValid","attr","window","entityFormHasUnsavedChanges","preventDefault","find","hide","show","formData","FormData","ajax","url","method","data","cache","contentType","processData","async","done","submit","fail","err","removeClass","remove","status","showToast","responseJSON","message","resetSubformSubmitAnimation","errors","errorKeys","Object","keys","foundAllErrors","forEach","i","errorSelector","addClass","parent","append","firstItem","firstItemDom","focus","form"],"sourceRoot":""}