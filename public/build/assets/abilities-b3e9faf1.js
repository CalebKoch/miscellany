import{_ as m,o as e,c as i,a as n,h as x,e as g,b as r,t as c,n as v,F as h,r as _,k as C,j as A,g as f,f as k,l as M}from"./_plugin-vue_export-helper-c420bb3b.js";import{m as D}from"./mitt-f7ef348c.js";import{v as L}from"./v-click-outside.umd-d5c5f7b0.js";import"./_commonjsHelpers-725317a4.js";const T={props:["ability","permission","meta","trans"],directives:{clickOutside:L.directive},data(){return{details:!1,openedDropdown:!1}},computed:{hasAttribute:function(){return this.ability.attributes.length>0},canDelete:function(){return this.permission},isSelf:function(){return this.meta.user_id===this.ability.created_by},backgroundImage:function(){return this.ability.images.thumb?{backgroundImage:"url("+this.ability.images.thumb+")"}:{}}},methods:{click:function(t){this.details=!this.details},deleteAbility:function(t){this.emitter.emit("delete_ability",t)},updateAbility:function(t){axios.get(t.actions.edit).then(l=>{$("#entity-modal").find(".modal-content").html(l.data),$("#entity-modal").modal()})},showAbility:function(t){window.open(t.actions.view,"_blank")},setVisibility:function(t){var l={visibility_id:t,ability_id:this.ability.ability_id};axios.patch(this.ability.actions.update,l).then(s=>{this.ability.visibility_id=t,this.emitter.emit("edited_ability",ability)}).catch(()=>{})},useCharge:function(t,l){l>t.used_charges?t.used_charges+=1:t.used_charges-=1,axios.post(t.actions.use,{used:t.used_charges}).then(s=>{s.data.success||(t.used_charges-=1)}).catch(()=>{t.used_charges-=1})},translate(t){return this.trans[t]??"unknown"},dropdownClass(){return this.openedDropdown?"open dropdown":"dropdown"},openDropdown(){return this.openedDropdown=!0},onClickOutside(t){this.openedDropdown=!1}}},j=["data-tags"],H={class:"ability-box p-3 rounded bg-box shadow-xs"},S={class:"ability-header border-b flex items-center gap-2 pb-2 mb-2"},V=["title"],I=["title"],F=["title"],O=["title"],P=["title"],B={class:"dropdown-menu",role:"menu"},N={key:0},z={key:1},E={key:2},J={key:3},q={class:"grow"},G=["data-id","data-url"],K=["title"],Q=n("i",{class:"fa-solid fa-pencil","aria-hidden":"true"},null,-1),R={class:"sr-only"},U={class:"ability-body entity-content"},W={class:"flex"},X={class:"flex-1"},Y={class:"help-block"},Z=["innerHTML"],tt=["innerHTML"],et={key:0,class:"flex-none text-right ml-2 mb-2"},it=["href"],st={key:0},nt={class:"charges relative"},at=["onClick"],lt={key:0,class:"fa-solid fa-chevron-down"},ot={key:2},rt={class:"dl-horizontal"},dt={key:0,class:"panel panel-default"},ct={class:"panel-heading"},ut={class:"panel-title"},ht={key:1},_t={key:0},bt={key:0,class:"fa-solid fa-check"},mt=["innerHTML"],yt={key:0,class:"fa-solid fa-chevron-up"};function ft(t,l,s,y,o,a){const b=C("click-outside");return e(),i("div",{class:"ability","data-tags":s.ability.class},[n("div",H,[n("div",S,[s.permission?x((e(),i("div",{key:0,class:g(a.dropdownClass())},[n("a",{onClick:l[0]||(l[0]=d=>a.openDropdown()),class:"dropdown-toggle",role:"button"},[s.ability.visibility_id===2?(e(),i("i",{key:0,class:"fa-solid fa-lock",title:a.translate("admin")},null,8,V)):r("",!0),s.ability.visibility_id===3?(e(),i("i",{key:1,class:"fa-solid fa-user-lock",title:a.translate("admin-self")},null,8,I)):r("",!0),s.ability.visibility_id===5?(e(),i("i",{key:2,class:"fa-solid fa-users",title:a.translate("members")},null,8,F)):r("",!0),s.ability.visibility_id===4?(e(),i("i",{key:3,class:"fa-solid fa-user-secret",title:a.translate("self")},null,8,O)):r("",!0),s.ability.visibility_id===1?(e(),i("i",{key:4,class:"fa-solid fa-eye",title:a.translate("all")},null,8,P)):r("",!0)]),n("ul",B,[n("li",null,[n("a",{role:"button",onClick:l[1]||(l[1]=d=>a.setVisibility(1))},c(a.translate("all")),1)]),s.meta.is_admin?(e(),i("li",N,[n("a",{role:"button",onClick:l[2]||(l[2]=d=>a.setVisibility(2))},c(a.translate("admin")),1)])):r("",!0),this.isSelf?(e(),i("li",z,[n("a",{role:"button",onClick:l[3]||(l[3]=d=>a.setVisibility(4))},c(a.translate("self")),1)])):r("",!0),this.isSelf?(e(),i("li",E,[n("a",{role:"button",onClick:l[4]||(l[4]=d=>a.setVisibility(5))},c(a.translate("members")),1)])):r("",!0),this.isSelf?(e(),i("li",J,[n("a",{role:"button",onClick:l[5]||(l[5]=d=>a.setVisibility(3))},c(a.translate("admin-self")),1)])):r("",!0)])],2)),[[b,a.onClickOutside]]):r("",!0),n("div",q,[n("a",{role:"button",onClick:l[6]||(l[6]=d=>a.showAbility(s.ability)),"data-toggle":"tooltip-ajax",class:"grow text-lg","data-id":s.ability.entity.id,"data-url":s.ability.entity.tooltip},c(s.ability.name),9,G)]),this.canDelete?(e(),i("a",{key:1,role:"button",onClick:l[7]||(l[7]=d=>a.updateAbility(s.ability)),class:"btn2 btn-ghost btn-xs",title:a.translate("update")},[Q,n("span",R,c(a.translate("update")),1)],8,K)):r("",!0)]),n("div",U,[n("div",W,[n("div",X,[n("span",Y,c(s.ability.type),1),n("div",{innerHTML:s.ability.entry},null,8,Z),n("div",{innerHTML:s.ability.note,class:"help-block"},null,8,tt)]),s.ability.images.has?(e(),i("div",et,[n("a",{class:"ability-image block w-32 h-32 cover-background",target:"_blank",href:s.ability.images.url,style:v(a.backgroundImage)},null,12,it)])):r("",!0)]),s.ability.charges&&s.permission?(e(),i("div",st,[n("div",nt,[(e(!0),i(h,null,_(s.ability.charges,d=>(e(),i("div",{class:g(["charge inline-block mr-2 h-5 w-5 cursor-pointer bg-white shadow-xs",{used:s.ability.used_charges>=d}]),onClick:w=>a.useCharge(s.ability,d)},null,10,at))),256))])])):r("",!0),a.hasAttribute?(e(),i("div",{key:1,class:"text-center cursor-pointer",onClick:l[8]||(l[8]=d=>a.click(s.ability))},[o.details?r("",!0):(e(),i("i",lt))])):r("",!0),o.details&&a.hasAttribute?(e(),i("div",ot,[n("dl",rt,[(e(!0),i(h,null,_(s.ability.attributes,d=>(e(),i("div",null,[d.type=="section"?(e(),i("div",dt,[n("div",ct,[n("h4",ut,c(d.name),1)])])):(e(),i("div",ht,[n("dt",null,c(d.name),1),d.type=="checkbox"?(e(),i("dd",_t,[d.value==1?(e(),i("i",bt)):r("",!0)])):(e(),i("dd",{key:1,innerHTML:d.value},null,8,mt))]))]))),256))])])):r("",!0),a.hasAttribute?(e(),i("div",{key:3,class:"text-center cursor-pointer",onClick:l[9]||(l[9]=d=>a.click(s.ability))},[o.details?(e(),i("i",yt)):r("",!0)])):r("",!0)])])],8,j)}const kt=m(T,[["render",ft]]),gt={props:["ability"],data(){return{active:!1}},computed:{backgroundImage:function(){return this.ability.has_image?{backgroundImage:"url("+this.ability.image+")"}:{}}},methods:{click:function(t){this.emitter.emit("click_parent",this.active?null:t)}},mounted(){this.emitter.on("click_parent",t=>{this.active=t&&t.id===this.ability.id})}},vt={class:"ability-name flex justify-center h-full w-full items-center cursor-pointer bg-white/70 hover:bg-black/10 transition-all duration-500"},pt={class:"name text-2xl"};function wt(t,l,s,y,o,a){return e(),i("div",{class:g(["ability-parent cover-background rounded overflow-hidden w-48 h-20",{active:o.active,without:!s.ability.has_image}]),style:v(a.backgroundImage),onClick:l[0]||(l[0]=b=>a.click(s.ability))},[n("div",vt,[n("div",pt,c(s.ability.name),1)])],6)}const xt=m(gt,[["render",wt]]),Ct={props:[],data(){return{modal:!1,modalContent:""}},methods:{showModal:function(t){this.modal=!0,axios.get(t).then(l=>{this.modalContent=l.data})},modalStyle:function(){return this.modal?"block":"hidden"}},mounted(){this.emitter.on("add_ability",t=>{this.showModal(t)})}},At={class:"modal-dialog",role:"document"},Mt=["innerHTML"];function Dt(t,l,s,y,o,a){return e(),i("div",{class:"modal fade in",style:v({display:this.modalStyle()}),tabindex:"-1",role:"dialog"},[n("div",At,[n("div",{class:"modal-content",innerHTML:o.modalContent},null,8,Mt)])],4)}const Lt=m(Ct,[["render",Dt]]),Tt={props:["id","api","permission","trans"],components:{Ability:kt,AbilityForm:Lt,Parent:xt},data(){return{abilities:[],parents:[],meta:[],loading:!0,show_parent:!1,parent:null,waiting:!1,modal:!1,json_trans:[]}},methods:{getAbilities:function(){axios.get(this.api).then(t=>{this.abilities=t.data.data.abilities,this.parents=t.data.data.parents,this.meta=t.data.data.meta,this.loading=!1,this.waiting=!1,this.parent&&(this.parent=this.parents[this.parent.id],this.showParent(this.parent))})},showParent:function(t){this.show_parent=!!t},addAbility:function(){this.emitter.emit("add_ability",this.meta.add_url)},deleteAbility:function(t){this.waiting=!0,axios.delete(t.actions.delete).then(()=>{this.getAbilities()}).catch(()=>{this.getAbilities()})},translate(t){return this.json_trans[t]??"unknown"}},mounted(){this.getAbilities(),this.emitter.on("click_parent",t=>{this.parent=t,this.showParent(t)}),this.emitter.on("delete_ability",t=>{this.deleteAbility(t)}),this.json_trans=JSON.parse(this.trans)},updated(){window.ajaxTooltip()}},jt={class:"viewport box-abilities relative"},Ht={key:0,class:"load more text-center"},St=n("i",{class:"fa-solid fa-spin fa-spinner"},null,-1),Vt=[St],It={class:"flex gap-5 flex-wrap my-5"},Ft={key:1,class:"flex flex-col gap-5"},Ot={key:0,class:"parent-box p-3 rounded bg-box shadow-xs"},Pt={class:"parent-header mb-2"},Bt=["href"],Nt=["innerHTML"],zt={class:"flex flex-col gap-5"},Et={key:2,class:"box-waiting absolute top-0 w-full h-full bg-black/20 text-center"},Jt=n("i",{class:"fa-solid fa-spin fa-spinner fa-4x mt-5"},null,-1),qt=[Jt];function Gt(t,l,s,y,o,a){const b=f("parent"),d=f("ability"),w=f("AbilityForm");return e(),i("div",jt,[o.loading?(e(),i("div",Ht,Vt)):r("",!0),n("div",It,[(e(!0),i(h,null,_(o.parents,u=>(e(),k(b,{key:u.id,ability:u},null,8,["ability"]))),128))]),o.show_parent?(e(),i("div",Ft,[o.parent.entry?(e(),i("div",Ot,[n("div",Pt,[n("a",{class:"text-lg",href:o.parent.url},c(o.parent.name),9,Bt)]),n("div",{class:"entity-content parent-body",innerHTML:o.parent.entry},null,8,Nt)])):r("",!0),(e(!0),i(h,null,_(o.parent.abilities,u=>(e(),k(d,{key:u.id,ability:u,permission:s.permission,meta:o.meta,trans:o.json_trans},null,8,["ability","permission","meta","trans"]))),128))])):r("",!0),n("div",zt,[o.show_parent?r("",!0):(e(!0),i(h,{key:0},_(o.abilities,u=>(e(),k(d,{key:u.id,ability:u,permission:s.permission,meta:o.meta,trans:o.json_trans},null,8,["ability","permission","meta","trans"]))),128))]),A(w,{trans:o.json_trans},null,8,["trans"]),o.waiting?(e(),i("div",Et,qt)):r("",!0)])}const Kt=m(Tt,[["render",Gt]]),Qt=D(),p=M({});p.config.globalProperties.emitter=Qt;p.component("abilities",Kt);p.mount("#abilities");
