import{a as b}from"./axios-47b9d439.js";var u,s,n,d,m,l,p,y;let i,g;$(document).ready(function(){E(),T(),f()});function E(){u=$("#gallery-loader"),s=$("#gallery-images"),n=$("#gallery-search"),i=$("#bulk-delete"),g=$("form#gallery-bulk"),l=document.getElementById("gallery-form"),$(".uploader"),d=$(".progress"),$("#file-upload"),m=$(".gallery-error");let t=$("#gallery-config");p=t.data("max"),y=t.data("error"),n.on("blur",function(a){a.preventDefault(),h()}).bind("keydown",function(a){a.key==="Enter"&&(a.preventDefault(),h())}),D(),g.submit(function(a){a.preventDefault();var e=new FormData;$.each($('li[data-selected="1"]'),function(o){e.append("file[]",$(this).data("id"))});let r=$('input[name="folder_id"]');return r&&e.append("folder_id",r.val()),$.ajax({url:$(this).attr("action"),method:"POST",context:this,data:e,cache:!1,contentType:!1,processData:!1}).done(function(o){return $('li[data-selected="1"]').remove(),document.getElementById("bulk-destroy-dialog").close(),i.addClass("btn-disabled"),window.showToast(o.toast),!1}),!1})}const D=()=>{l&&(l.ondrop=t=>{if(t.preventDefault(),t.stopPropagation(),t.dataTransfer.items){let a=new FormData,e=0;if([...t.dataTransfer.items].forEach((o,c)=>{o.kind==="file"&&(a.append("file[]",o.getAsFile()),e++)}),e>p){w();return}let r=$('input[name="folder_id"]');r&&a.append("folder_id",r.val()),v(a),l.classList.remove("drop-shadow","dropping")}else[...t.dataTransfer.files].forEach((a,e)=>{})},l.ondragover=t=>{t.preventDefault(),l.classList.add("drop-shadow","dropping")},l.ondragleave=t=>{l.classList.remove("drop-shadow","dropping")})};function h(){s.hide(),u.show(),$.ajax({url:n.data("url")+"?q="+n.val()}).done(function(t){u.hide(),s.html(t).show(),f()})}function T(){l&&(l.onchange=t=>{t.preventDefault();let a=document.getElementById("file-upload");if(a.files.length>p){w();return}var e=new FormData;Array.from(a.files).forEach(o=>{e.append("file[]",o)});let r=$('input[name="folder_id"]');r&&e.append("folder_id",r.val()),v(e)})}const w=()=>{window.showToast(y,"error")},v=t=>{var a={headers:{"Content-Type":"multipart/form-data"},onUploadProgress:function(e){let r=Math.round(e.loaded*100/e.total);$('[role="progressbar"]').css("width",r+"%")}};d.show(),b.post(l.action,t,a).then(function(e){d.hide(),e.data.success&&(e.data.images.forEach(r=>{$("li[data-folder]").last().length===1?$(r).insertAfter($("li[data-folder]").last()):s.prepend(r)}),F(e.data.storage),f())}).catch(function(e){if(d.hide(),e.response&&e.response.data.message){m.text(e.response.data.message).fadeToggle();let r=e.response.data.errors;Object.keys(r).forEach(c=>{window.showToast(r[c],"error")})}f()})};function f(){$("#gallery-images li").unbind("click").on("click",function(t){if(t.shiftKey){if(!$(this).data("id"))return;$(this).toggleClass("border-2 border-blue-500"),$(this).attr("data-selected")==="1"?$(this).attr("data-selected",""):$(this).attr("data-selected",1),k();return}let a=$(this).data("folder");if(a){window.location=a;return}window.openDialog("primary-dialog",$(this).data("url"))})}const k=()=>{$('li[data-selected="1"]').length===0?i.addClass("btn-disabled"):i.removeClass("btn-disabled")},F=t=>{let a=document.getElementById("storage-progress");a.style.width=t.percentage+"%",a.className=t.progress;let e=document.getElementById("storage-used");e.innerHTML=t.used};
