import{a as b}from"./index-0b481a1e.js";import"./_commonjsHelpers-725317a4.js";var c,i,n,s,m,l,p,y;let u,g;$(document).ready(function(){E(),D(),f()});function E(){c=$("#gallery-loader"),i=$("#gallery-images"),n=$("#gallery-search"),u=$("#bulk-delete"),g=$("form#gallery-bulk"),l=document.getElementById("gallery-form"),$(".uploader"),s=$(".progress"),$("#file-upload"),m=$(".gallery-error");let r=$("#gallery-config");p=r.data("max"),y=r.data("error"),n.on("blur",function(e){e.preventDefault(),h()}).bind("keydown",function(e){e.key==="Enter"&&(e.preventDefault(),h())}),l.ondrop=e=>{if(e.preventDefault(),e.stopPropagation(),e.dataTransfer.items){let t=new FormData,a=0;if([...e.dataTransfer.items].forEach((d,F)=>{d.kind==="file"&&(t.append("file[]",d.getAsFile()),a++)}),a>p){w();return}let o=$('input[name="folder_id"]');o&&t.append("folder_id",o.val()),v(t),l.classList.remove("drop-shadow","dropping")}else[...e.dataTransfer.files].forEach((t,a)=>{})},l.ondragover=e=>{e.preventDefault(),l.classList.add("drop-shadow","dropping")},l.ondragleave=e=>{l.classList.remove("drop-shadow","dropping")},g.submit(function(e){e.preventDefault();var t=new FormData;$.each($('li[data-selected="1"]'),function(o){t.append("file[]",$(this).data("id"))});let a=$('input[name="folder_id"]');return a&&t.append("folder_id",a.val()),$.ajax({url:$(this).attr("action"),method:"POST",context:this,data:t,cache:!1,contentType:!1,processData:!1}).done(function(o){return $('li[data-selected="1"]').remove(),document.getElementById("bulk-destroy-dialog").close(),window.showToast(o.toast),!1}),!1})}function h(){i.hide(),c.show(),$.ajax({url:n.data("url")+"?q="+n.val()}).done(function(r){c.hide(),i.html(r).show(),f()})}function D(){l.onchange=r=>{r.preventDefault();let e=document.getElementById("file-upload");if(e.files.length>p){w();return}var t=new FormData;Array.from(e.files).forEach(o=>{t.append("file[]",o)});let a=$('input[name="folder_id"]');a&&t.append("folder_id",a.val()),v(t)}}const w=()=>{window.showToast(y,"toast-error")},v=r=>{var e={headers:{"Content-Type":"multipart/form-data"},onUploadProgress:function(t){let a=Math.round(t.loaded*100/t.total);$('[role="progressbar"]').css("width",a+"%")}};s.show(),b.post(l.action,r,e).then(function(t){s.hide(),t.data.success&&(t.data.images.forEach(a=>{$("li[data-folder]").last().length===1?$(a).insertAfter($("li[data-folder]").last()):i.prepend(a)}),k(t.data.storage),f())}).catch(function(t){if(s.hide(),t.response&&t.response.data.message){m.text(t.response.data.message).fadeToggle();let a=t.response.data.errors;Object.keys(a).forEach(d=>{window.showToast(a[d],"toast-error")})}f()})};function f(){$("#gallery-images li").unbind("click").on("click",function(r){if(r.shiftKey){if(!$(this).data("id"))return;$(this).toggleClass("border-2 border-blue-500"),$(this).attr("data-selected")==="1"?$(this).attr("data-selected",""):$(this).attr("data-selected",1),T();return}let e=$(this).data("folder");if(e){window.location=e;return}window.openDialog("primary-dialog",$(this).data("url"))})}const T=()=>{$('li[data-selected="1"]').length===0?u.hide():u.show()},k=r=>{let e=document.getElementById("storage-progress");e.style.width=r.percentage+"%",e.className=r.progress;let t=document.getElementById("storage-used");t.innerHTML=r.used};
