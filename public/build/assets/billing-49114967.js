import{_ as y,c,h as d,s as l,a as t,F as M,r as b,d as _,t as o,v as g,o as m,w as v,l as S}from"./_plugin-vue_export-helper-de6cf830.js";const f={props:["api_token","trans"],data(){return{stripe:"",elements:"",card:"",intentToken:"",name:"",addPaymentStatus:0,addPaymentStatusError:"",paymentMethods:[],paymentMethodsLoadStatus:0,paymentMethodSelected:0,showNewPaymentMethod:!1,savePaymentMethodStatus:0,deletingPaymentMethodStatus:0,json_trans:[]}},mounted(){this.includeStripe("js.stripe.com/v3/",function(){this.configureStripe()}.bind(this)),this.loadIntent(),this.loadPaymentMethods(),this.json_trans=JSON.parse(this.trans)},methods:{includeStripe(s,i){let h=document,r="script",a=h.createElement(r),e=h.getElementsByTagName(r)[0];a.src="//"+s,i&&a.addEventListener("load",function(n){i(null,n)},!1),e.parentNode.insertBefore(a,e)},configureStripe(){this.stripe=Stripe(this.api_token),this.elements=this.stripe.elements(),this.card=this.elements.create("card",{hidePostalCode:!0}),this.card.mount("#card-element")},loadIntent(){axios.get("/subscription-api/setup-intent").then(function(s){this.intentToken=s.data}.bind(this))},submitPaymentMethod(){this.addPaymentStatus=1,this.savePaymentMethodStatus=1,this.stripe.confirmCardSetup(this.intentToken.client_secret,{payment_method:{card:this.card,billing_details:{name:this.name}}}).then(function(s){this.savePaymentMethodStatus=0,s.error?(this.addPaymentStatus=3,this.addPaymentStatusError=s.error.message):(this.savePaymentMethod(s.setupIntent.payment_method),this.addPaymentStatus=2,this.card.clear(),this.name="",this.toggleShowNewPaymentMethod())}.bind(this))},savePaymentMethod(s){this.paymentMethodsLoadStatus=0,axios.post("/subscription-api/payments",{payment_method:s}).then(function(){this.loadPaymentMethods()}.bind(this))},loadPaymentMethods(){this.paymentMethodsLoadStatus=1,axios.get("/subscription-api/payment-methods").then(function(s){this.paymentMethods=s.data,this.paymentMethodsLoadStatus=2}.bind(this))},removePaymentMethod(s){this.paymentMethodsLoadStatus=0,axios.post("/subscription-api/remove-payment",{id:s}).then(function(i){this.loadPaymentMethods()}.bind(this))},toggleShowNewPaymentMethod(){this.showNewPaymentMethod=!this.showNewPaymentMethod},translate(s){return this.json_trans[s]??"unknown"}}},P={class:"text-center"},w=t("i",{class:"fa-solid fa-spin fa-spinner"},null,-1),x=[w],k={class:"box-body"},N={class:"row"},L={class:"col-xs-2"},C={class:"col-xs-7"},T={class:"col-xs-3 text-right"},E=["onClick"],B=t("i",{class:"fa-solid fa-trash"},null,-1),j=[B],I={class:"help-block"},V=t("i",{class:"far fa-credit-card"},null,-1),A={class:"showNewCard"},D={class:"modal",tabindex:"-1",role:"dialog",style:{display:"block"}},F={class:"modal-dialog modal-lg",role:"document"},U={class:"modal-content"},J={class:"modal-header"},O=t("span",{"aria-hidden":"true"},"Ã—",-1),R=[O],q={class:"modal-title",id:"clickModalLabel"},z={class:"box-title"},G={class:"modal-body"},H=t("div",{id:"card-element"},null,-1),K={class:"help-block"},Q={class:"modal-footer"},W={class:"btn btn-primary",disabled:"disabled"},X=t("i",{class:"fa-solid fa-spin fa-spinner"},null,-1),Y=[X];function Z(s,i,h,r,a,e){return m(),c("div",null,[d(t("div",P,x,512),[[l,a.paymentMethodsLoadStatus!=2]]),d(t("div",null,[(m(!0),c(M,null,b(a.paymentMethods,(n,u)=>(m(),c("div",{key:"method-"+u,class:"box box-solid"},[t("div",k,[t("div",N,[t("div",L,o(n.brand.charAt(0).toUpperCase())+o(n.brand.slice(1)),1),t("div",C,o(e.translate("ending"))+": "+o(n.last_four)+" Exp: "+o(n.exp_month)+" / "+o(n.exp_year),1),t("div",T,[t("span",{onClick:v(tt=>e.removePaymentMethod(n.id),["stop"]),title:"Remove",class:"text-red"},j,8,E)])])])]))),128))],512),[[l,a.paymentMethodsLoadStatus==2&&a.paymentMethods.length>0]]),d(t("div",null,[t("p",I,[_(o(e.translate("add_one"))+" ",1),t("a",{href:"#",onClick:i[0]||(i[0]=(...n)=>e.toggleShowNewPaymentMethod&&e.toggleShowNewPaymentMethod(...n))},[V,_(" "+o(e.translate("actions.add_new")),1)])])],512),[[l,a.paymentMethodsLoadStatus==2&&a.paymentMethods.length==0]]),d(t("div",A,[t("div",D,[t("div",F,[t("div",U,[t("div",J,[t("button",{type:"button",class:"close","data-dismiss":"modal",onClick:i[1]||(i[1]=(...n)=>e.toggleShowNewPaymentMethod&&e.toggleShowNewPaymentMethod(...n))},R),t("h4",q,[t("h4",z,o(e.translate("new_card")),1)])]),t("div",G,[t("label",null,o(e.translate("card_name")),1),d(t("input",{id:"card-holder-name",type:"text","onUpdate:modelValue":i[2]||(i[2]=n=>a.name=n),class:"form-control mb-2"},null,512),[[g,a.name]]),t("label",null,o(e.translate("card")),1),H,t("p",K,o(e.translate("helper")),1)]),t("div",Q,[d(t("button",{class:"btn btn-primary",id:"add-card-button",onClick:i[3]||(i[3]=n=>e.submitPaymentMethod())},o(e.translate("actions.save")),513),[[l,a.savePaymentMethodStatus==0]]),d(t("button",W,Y,512),[[l,a.savePaymentMethodStatus!=0]])])])])])],512),[[l,a.showNewPaymentMethod]])])}const $=y(f,[["render",Z]]),p=S({});p.component("billing-management",$);p.mount("#billing");
