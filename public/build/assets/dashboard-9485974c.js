import{a as u}from"./ajax-modal-1230002e.js";import{S as f}from"./sortable.esm-be94e56d.js";var r,d,l,a,w=new IntersectionObserver(function(e){e.forEach(t=>{t.isIntersecting&&b(e[0].target)})},{threshold:[0]});$(document).ready(function(){$(".widget-render").length>0&&document.querySelectorAll(".widget-render").forEach(e=>{e&&w.observe(e)}),$(".preview-switch").click(function(e){e.preventDefault();var t=$("#widget-preview-body-"+$(this).data("widget"));t.hasClass("preview")?(t.removeClass("preview").addClass("full"),$(this).html('<i class="fa-solid fa-chevron-up"></i>')):(t.removeClass("full").addClass("preview"),$(this).html('<i class="fa-solid fa-chevron-down"></i>'))}),$('[data-release="remove"]').click(function(){$.post({url:$(this).data("url"),method:"POST",context:this}).done(function(){$(this).closest(".box").fadeOut("normal",function(){$(this).remove(),$(".dashboard-releases .box").length===0&&$(".dashboard-releases").remove()})})}),$(".campaign-dashboard-widgets").length===1&&m(),h(),s(),p(),v(),x()});function m(){$("#new-widget"),$("#new-widget-preview"),$("#new-widget-calendar"),$("#new-widget-recent"),r=$("#btn-add-widget"),d=$("#modal-content-buttons"),l=$("#modal-content-target"),a=$("#modal-content-spinner"),$(".widget-list > a").click(function(t){t.preventDefault(),g($(this).data("url"))}),r.click(function(){a.hide(),l.html(""),d.show()});let e=document.getElementById("widgets");new f(e,{handle:".handle",onEnd:function(t){$.post({url:$("#widgets").data("url"),dataType:"json",data:$('input[name="widgets[]"]').serialize()}).done(function(n){n.success&&n.message&&window.showToast(n.message)})}}),$(document).on("shown.bs.modal shown.bs.popover",function(){$("#summernote-config").length>0&&window.initSummernote(),$.each($(".img-delete"),function(){$(this).click(function(n){n.preventDefault(),$("input[name="+$(this).data("target")+"]")[0].value=1,$(this).parent().parent().hide()})}),c()})}function g(e){$("#edit-widget .modal-content").html(""),d.hide(),a.show(),$.ajax(e).done(function(t){a.hide(),l.html(t),window.initForeignSelect(),window.initTags(),c()})}function c(){$(".recent-entity-type").change(function(){this.value?$(".recent-filters").show():$(".recent-filters").hide()})}function h(){$(".widget-recent-more").click(function(e){e.preventDefault(),$(this).find(".spinner").show(),$(this).find("span").hide(),$.ajax({url:$(this).data("url"),context:this}).done(function(t){$(this).closest(".widget-recent-list").append(t),$(this).remove(),h(),window.ajaxTooltip()})})}function s(){$(".widget-calendar-switch").unbind("click").click(function(e){e.preventDefault();var t=$(this).data("url"),n=$(this).data("widget");$("#widget-body-"+n).find(".widget-body").hide(),$("#widget-body-"+n).find(".widget-loading").show(),$.ajax({url:t,method:"POST",context:this}).done(function(i){if(i){var o=$(this).data("widget");$("#widget-body-"+o).find(".widget-loading").hide(),$("#widget-body-"+o).find(".widget-body").html(i).show(),window.ajaxTooltip(),s()}})})}function p(){var e=$("#campaign-follow"),t=$("#campaign-follow-text");if(e.length===1){var n=e.data("following");n?t.html(e.data("unfollow")):t.html(e.data("follow")),e.show(),e.click(function(i){i.preventDefault(),$.post({url:$(this).data("url"),method:"POST"}).done(function(o){o.following?t.html(e.data("unfollow")):t.html(e.data("follow"))})})}}function v(){$.each($('[data-toggle="preview"]'),function(){$(this).height()===parseInt($(this).css("max-height"))?$(this).next().removeClass("hidden"):$(this).removeClass("pinned-entity preview")})}function b(e){e=$(e),$.ajax({url:e.data("url")}).done(function(t){e.find(".widget-loading").hide(),e.find(".widget-body").html(t).show(),window.ajaxTooltip(),u(),s()})}function x(){document.querySelectorAll("[data-pulse]").forEach(e=>{e.addEventListener("click",y)})}function y(e){e.preventDefault();let t=document.querySelector(this.dataset.pulse),n=this.dataset.content;window.showTooltip(t,{content:n,theme:"kanka",placement:"bottom",allowHTML:!0,arrow:!0,interactive:!0,trigger:"manual"})}
