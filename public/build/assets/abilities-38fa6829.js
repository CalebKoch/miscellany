import{_ as m,o as e,c as i,a as n,h as p,e as v,b as o,t as c,n as g,F as h,r as _,k as C,j as A,g as f,f as k,l as D}from"./_plugin-vue_export-helper-de6cf830.js";import{m as M}from"./mitt-f7ef348c.js";import{v as L}from"./v-click-outside.umd-d5c5f7b0.js";import"./_commonjsHelpers-725317a4.js";const T={props:["ability","permission","meta","trans"],directives:{clickOutside:L.directive},data(){return{details:!1,openedDropdown:!1}},computed:{hasAttribute:function(){return this.ability.attributes.length>0},canDelete:function(){return this.permission},isSelf:function(){return this.meta.user_id===this.ability.created_by},backgroundImage:function(){return this.ability.images.thumb?{backgroundImage:"url("+this.ability.images.thumb+")"}:{}}},methods:{click:function(t){this.details=!this.details},deleteAbility:function(t){this.emitter.emit("delete_ability",t)},updateAbility:function(t){axios.get(t.actions.edit).then(l=>{$("#entity-modal").find(".modal-content").html(l.data),$("#entity-modal").modal()})},showAbility:function(t){window.open(t.actions.view,"_blank")},setVisibility:function(t){var l={visibility_id:t,ability_id:this.ability.ability_id};axios.patch(this.ability.actions.update,l).then(s=>{this.ability.visibility_id=t,this.emitter.emit("edited_ability",ability)}).catch(()=>{})},useCharge:function(t,l){l>t.used_charges?t.used_charges+=1:t.used_charges-=1,axios.post(t.actions.use,{used:t.used_charges}).then(s=>{s.data.success||(t.used_charges-=1)}).catch(()=>{t.used_charges-=1})},translate(t){return this.trans[t]??"unknown"},dropdownClass(){return this.openedDropdown?"open dropdown":"dropdown"},openDropdown(){return this.openedDropdown=!0},onClickOutside(t){this.openedDropdown=!1}}},j=["data-tags"],H={class:"box box-solid"},S={class:"box-header with-border"},V={class:"box-title"},I=["title"],F=["title"],O=["title"],P=["title"],B=["title"],N={class:"dropdown-menu",role:"menu"},z={key:0},E={key:1},J={key:2},q={key:3},G=["data-id","data-url"],K={class:"box-tools"},Q=["title"],R=n("i",{class:"fa-solid fa-pencil"},null,-1),U=[R],W=["title"],X=n("i",{class:"fa-solid fa-trash"},null,-1),Y=[X],Z={class:"box-body"},tt={class:"flex"},et={class:"flex-1"},it={class:"help-block"},st=["innerHTML"],nt=["innerHTML"],lt={key:0,class:"flex-none text-right ml-2 mb-2"},at=["href"],ot={key:0},rt={class:"charges relative"},dt=["onClick"],ct={key:0,class:"fa-solid fa-chevron-down"},ut={key:2},ht={class:"dl-horizontal"},_t={key:0,class:"panel panel-default"},bt={class:"panel-heading"},mt={class:"panel-title"},yt={key:1},ft={key:0},kt={key:0,class:"fa-solid fa-check"},vt=["innerHTML"],gt={key:0,class:"fa-solid fa-chevron-up"};function wt(t,l,s,y,r,a){const b=C("click-outside");return e(),i("div",{class:"ability","data-tags":s.ability.class},[n("div",H,[n("div",S,[n("span",V,[s.permission?p((e(),i("span",{key:0,class:v(a.dropdownClass())},[n("a",{onClick:l[0]||(l[0]=d=>a.openDropdown()),class:"dropdown-toggle mr-2",role:"button"},[s.ability.visibility_id===2?(e(),i("i",{key:0,class:"fa-solid fa-lock",title:a.translate("admin")},null,8,I)):o("",!0),s.ability.visibility_id===3?(e(),i("i",{key:1,class:"fa-solid fa-user-lock",title:a.translate("admin-self")},null,8,F)):o("",!0),s.ability.visibility_id===5?(e(),i("i",{key:2,class:"fa-solid fa-users",title:a.translate("members")},null,8,O)):o("",!0),s.ability.visibility_id===4?(e(),i("i",{key:3,class:"fa-solid fa-user-secret",title:a.translate("self")},null,8,P)):o("",!0),s.ability.visibility_id===1?(e(),i("i",{key:4,class:"fa-solid fa-eye",title:a.translate("all")},null,8,B)):o("",!0)]),n("ul",N,[n("li",null,[n("a",{role:"button",onClick:l[1]||(l[1]=d=>a.setVisibility(1))},c(a.translate("all")),1)]),s.meta.is_admin?(e(),i("li",z,[n("a",{role:"button",onClick:l[2]||(l[2]=d=>a.setVisibility(2))},c(a.translate("admin")),1)])):o("",!0),this.isSelf?(e(),i("li",E,[n("a",{role:"button",onClick:l[3]||(l[3]=d=>a.setVisibility(4))},c(a.translate("self")),1)])):o("",!0),this.isSelf?(e(),i("li",J,[n("a",{role:"button",onClick:l[4]||(l[4]=d=>a.setVisibility(5))},c(a.translate("members")),1)])):o("",!0),this.isSelf?(e(),i("li",q,[n("a",{role:"button",onClick:l[5]||(l[5]=d=>a.setVisibility(3))},c(a.translate("admin-self")),1)])):o("",!0)])],2)),[[b,a.onClickOutside]]):o("",!0),n("a",{role:"button",onClick:l[6]||(l[6]=d=>a.showAbility(s.ability)),"data-toggle":"tooltip-ajax","data-id":s.ability.entity.id,"data-url":s.ability.entity.tooltip},c(s.ability.name),9,G)]),n("div",K,[this.canDelete?(e(),i("a",{key:0,role:"button",onClick:l[7]||(l[7]=d=>a.updateAbility(s.ability)),class:"btn btn-box-tool",title:a.translate("update")},U,8,Q)):o("",!0),this.canDelete?(e(),i("a",{key:1,class:"btn btn-box-tool",role:"button",onClick:l[8]||(l[8]=d=>a.deleteAbility(s.ability)),title:a.translate("remove")},Y,8,W)):o("",!0)])]),n("div",Z,[n("div",tt,[n("div",et,[n("span",it,c(s.ability.type),1),n("div",{innerHTML:s.ability.entry},null,8,st),n("div",{innerHTML:s.ability.note,class:"help-block"},null,8,nt)]),s.ability.images.has?(e(),i("div",lt,[n("a",{class:"ability-image block w-32 h-32 cover-background",target:"_blank",href:s.ability.images.url,style:g(a.backgroundImage)},null,12,at)])):o("",!0)]),s.ability.charges&&s.permission?(e(),i("div",ot,[n("div",rt,[(e(!0),i(h,null,_(s.ability.charges,d=>(e(),i("div",{class:v(["charge inline-block mr-2 h-5 w-5 cursor-pointer bg-white shadow-xs",{used:s.ability.used_charges>=d}]),onClick:x=>a.useCharge(s.ability,d)},null,10,dt))),256))])])):o("",!0),a.hasAttribute?(e(),i("div",{key:1,class:"text-center cursor-pointer",onClick:l[9]||(l[9]=d=>a.click(s.ability))},[r.details?o("",!0):(e(),i("i",ct))])):o("",!0),r.details&&a.hasAttribute?(e(),i("div",ut,[n("dl",ht,[(e(!0),i(h,null,_(s.ability.attributes,d=>(e(),i("div",null,[d.type=="section"?(e(),i("div",_t,[n("div",bt,[n("h4",mt,c(d.name),1)])])):(e(),i("div",yt,[n("dt",null,c(d.name),1),d.type=="checkbox"?(e(),i("dd",ft,[d.value==1?(e(),i("i",kt)):o("",!0)])):(e(),i("dd",{key:1,innerHTML:d.value},null,8,vt))]))]))),256))])])):o("",!0),a.hasAttribute?(e(),i("div",{key:3,class:"text-center cursor-pointer",onClick:l[10]||(l[10]=d=>a.click(s.ability))},[r.details?(e(),i("i",gt)):o("",!0)])):o("",!0)])])],8,j)}const xt=m(T,[["render",wt]]),pt={props:["ability"],data(){return{active:!1}},computed:{backgroundImage:function(){return this.ability.has_image?{backgroundImage:"url("+this.ability.image+")"}:{}}},methods:{click:function(t){this.emitter.emit("click_parent",this.active?null:t)}},mounted(){this.emitter.on("click_parent",t=>{this.active=t&&t.id===this.ability.id})}},Ct={class:"col-xs-4 col-sm-3 col-lg-3 text-center"},At={class:"ability-name flex justify-center h-full w-full items-center cursor-pointer bg-white/70 hover:bg-black/10"},Dt={class:"name m-auto p-3 text-2xl"};function Mt(t,l,s,y,r,a){return e(),i("div",Ct,[n("div",{class:v(["ability-parent cover-background rounded overflow-hidden mb-4",{active:r.active,without:!s.ability.has_image}]),style:g(a.backgroundImage),onClick:l[0]||(l[0]=b=>a.click(s.ability))},[n("div",At,[n("div",Dt,c(s.ability.name),1)])],6)])}const Lt=m(pt,[["render",Mt]]),Tt={props:[],data(){return{modal:!1,modalContent:""}},methods:{showModal:function(t){this.modal=!0,axios.get(t).then(l=>{this.modalContent=l.data})},modalStyle:function(){return this.modal?"block":"hidden"}},mounted(){this.emitter.on("add_ability",t=>{this.showModal(t)})}},jt={class:"modal-dialog",role:"document"},Ht=["innerHTML"];function St(t,l,s,y,r,a){return e(),i("div",{class:"modal fade in",style:g({display:this.modalStyle()}),tabindex:"-1",role:"dialog"},[n("div",jt,[n("div",{class:"modal-content",innerHTML:r.modalContent},null,8,Ht)])],4)}const Vt=m(Tt,[["render",St]]),It={props:["id","api","permission","trans"],components:{Ability:xt,AbilityForm:Vt,Parent:Lt},data(){return{abilities:[],parents:[],meta:[],loading:!0,show_parent:!1,parent:null,waiting:!1,modal:!1,json_trans:[]}},methods:{getAbilities:function(){axios.get(this.api).then(t=>{this.abilities=t.data.data.abilities,this.parents=t.data.data.parents,this.meta=t.data.data.meta,this.loading=!1,this.waiting=!1,this.parent&&(this.parent=this.parents[this.parent.id],this.showParent(this.parent))})},showParent:function(t){this.show_parent=!!t},addAbility:function(){this.emitter.emit("add_ability",this.meta.add_url)},deleteAbility:function(t){this.waiting=!0,axios.delete(t.actions.delete).then(()=>{this.getAbilities()}).catch(()=>{this.getAbilities()})},translate(t){return this.json_trans[t]??"unknown"}},mounted(){this.getAbilities(),this.emitter.on("click_parent",t=>{this.parent=t,this.showParent(t)}),this.emitter.on("delete_ability",t=>{this.deleteAbility(t)}),this.json_trans=JSON.parse(this.trans)},updated(){window.ajaxTooltip()}},Ft={class:"viewport box-abilities relative"},Ot={key:0,class:"load more text-center"},Pt=n("i",{class:"fa-solid fa-spin fa-spinner"},null,-1),Bt=[Pt],Nt={class:"row"},zt={key:1},Et={key:0,class:"box box-solid"},Jt={class:"box-header"},qt={class:"box-title"},Gt=["innerHTML"],Kt={key:3,class:"box-waiting absolute top-0 w-full h-full bg-black/20 text-center"},Qt=n("i",{class:"fa-solid fa-spin fa-spinner fa-4x mt-5"},null,-1),Rt=[Qt];function Ut(t,l,s,y,r,a){const b=f("parent"),d=f("ability"),x=f("AbilityForm");return e(),i("div",Ft,[r.loading?(e(),i("div",Ot,Bt)):o("",!0),n("div",Nt,[(e(!0),i(h,null,_(r.parents,u=>(e(),k(b,{key:u.id,ability:u},null,8,["ability"]))),128))]),r.show_parent?(e(),i("div",zt,[r.parent.entry?(e(),i("div",Et,[n("div",Jt,[n("span",qt,c(r.parent.name),1)]),n("div",{class:"box-body",innerHTML:r.parent.entry},null,8,Gt)])):o("",!0),(e(!0),i(h,null,_(r.parent.abilities,u=>(e(),k(d,{key:u.id,ability:u,permission:s.permission,meta:r.meta,trans:r.json_trans},null,8,["ability","permission","meta","trans"]))),128))])):o("",!0),r.show_parent?o("",!0):(e(!0),i(h,{key:2},_(r.abilities,u=>(e(),k(d,{key:u.id,ability:u,permission:s.permission,meta:r.meta,trans:r.json_trans},null,8,["ability","permission","meta","trans"]))),128)),A(x,{trans:r.json_trans},null,8,["trans"]),r.waiting?(e(),i("div",Kt,Rt)):o("",!0)])}const Wt=m(It,[["render",Ut]]),Xt=M(),w=D({});w.config.globalProperties.emitter=Xt;w.component("abilities",Wt);w.mount("#abilities");
