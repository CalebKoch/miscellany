import{a as b}from"./index-0b481a1e.js";import"./_commonjsHelpers-725317a4.js";var c,s,i,n,m,o,u,y;let p,g;$(document).ready(function(){E(),T(),f()});function E(){c=$("#gallery-loader"),s=$("#gallery-images"),i=$("#gallery-search"),p=$("#bulk-delete"),g=$("form#gallery-bulk"),o=document.getElementById("gallery-form"),$(".uploader"),n=$(".progress"),$("#file-upload"),m=$(".gallery-error");let r=$("#gallery-config");u=r.data("max"),y=r.data("error"),i.on("blur",function(t){t.preventDefault(),h()}).bind("keydown",function(t){t.key==="Enter"&&(t.preventDefault(),h())}),o.ondrop=t=>{if(t.preventDefault(),t.stopPropagation(),t.dataTransfer.items){let e=new FormData,a=0;if([...t.dataTransfer.items].forEach((d,F)=>{d.kind==="file"&&(e.append("file[]",d.getAsFile()),a++)}),a>u){w();return}let l=$('input[name="folder_id"]');l&&e.append("folder_id",l.val()),v(e),o.classList.remove("drop-shadow","dropping")}else[...t.dataTransfer.files].forEach((e,a)=>{})},o.ondragover=t=>{t.preventDefault(),o.classList.add("drop-shadow","dropping")},o.ondragleave=t=>{o.classList.remove("drop-shadow","dropping")},g.submit(function(t){t.preventDefault();var e=new FormData;$.each($('li[data-selected="1"]'),function(l){e.append("file[]",$(this).data("id"))});let a=$('input[name="folder_id"]');return a&&e.append("folder_id",a.val()),$.ajax({url:$(this).attr("action"),method:"POST",context:this,data:e,cache:!1,contentType:!1,processData:!1}).done(function(l){return $('li[data-selected="1"]').remove(),document.getElementById("bulk-destroy-dialog").close(),window.showToast(l.toast),!1}),!1})}function h(){s.hide(),c.show(),$.ajax({url:i.data("url")+"?q="+i.val()}).done(function(r){c.hide(),s.html(r).show(),f()})}function T(){o.onchange=r=>{r.preventDefault();let t=document.getElementById("file-upload");if(t.files.length>u){w();return}var e=new FormData;Array.from(t.files).forEach(l=>{e.append("file[]",l)});let a=$('input[name="folder_id"]');a&&e.append("folder_id",a.val()),v(e)}}const w=()=>{window.showToast(y,"toast-error")},v=r=>{var t={headers:{"Content-Type":"multipart/form-data"},onUploadProgress:function(e){let a=Math.round(e.loaded*100/e.total);$('[role="progressbar"]').css("width",a+"%")}};n.show(),b.post(o.action,r,t).then(function(e){n.hide(),e.data.success&&(e.data.images.forEach(a=>{$("li[data-folder]").last().length===1?$(a).insertAfter($("li[data-folder]").last()):s.prepend(a)}),D(e.data.storage),f())}).catch(function(e){if(n.hide(),e.response&&e.response.data.message){m.text(e.response.data.message).fadeToggle();let a=e.response.data.errors;Object.keys(a).forEach(d=>{window.showToast(a[d],"toast-error")})}f()})};function f(){$("#gallery-images li").unbind("click").on("click",function(r){if(r.shiftKey){if(!$(this).data("id"))return;$(this).toggleClass("border-2 border-blue-500"),$(this).attr("data-selected")==="1"?$(this).attr("data-selected",""):$(this).attr("data-selected",1),k();return}let t=$(this).data("folder");if(t){window.location=t;return}$.ajax({url:$(this).data("url")}).done(function(e){$("#large-modal-content").html(e),$("#large-modal").modal("show")})})}const k=()=>{$('li[data-selected="1"]').length===0?p.hide():p.show()},D=r=>{let t=document.getElementById("storage-progress");t.style.width=r.percentage+"%",t.className=r.progress;let e=document.getElementById("storage-used");e.innerHTML=r.used};
