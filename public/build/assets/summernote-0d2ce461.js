var a,o=!1;$(document).ready(function(){a=$("#summernote-config"),a.length>0&&window.initSummernote()});window.initSummernote=function(){const e=$(".html-editor").summernote({height:"300px",maximumImageFileSize:parseInt(a.data("filesize"))*1024,lang:T(a.data("locale")),hintSelect:"next",placeholder:a.data("placeholder"),dialogsInBody:a.data("dialogs")===1,toolbar:[["style",["style"]],["font",["bold","italic","underline","strikethrough","clear"]],["color",["color"]],["kanka",["aroba",a.data("bragi")!==void 0?"bragi":null]],["para",["ul","ol","kanka-indent","kanka-outdent","paragraph"]],["table",["table","tableofcontent"]],["insert",["link","picture","video","embed","hr"]],["view",["fullscreen","codeview","prettify","help"]],a.data("gallery")!==""?["extensions",["summernoteGallery"]]:null],popover:{table:[["add",["addRowDown","addRowUp","addColLeft","addColRight"]],["delete",["deleteRow","deleteCol","deleteTable"]],["custom",["tableHeaders"]],["custom",["tableStyles"]]],image:[["image",["resizeFull","resizeHalf","resizeQuarter","resizeNone"]],["float",["floatLeft","floatRight","floatNone"]],["remove",["removeMedia"]],["custom",["imageAttributes"]]]},callbacks:{onImageUpload:function(t){y(e,t[0])},onChange:function(){window.entityFormHasUnsavedChanges=!0},onChangeCodeview:function(t,n){$(this).summernote("code",t)}},summernoteGallery:{source:{url:a.data("gallery"),responseDataKey:"data",nextPageKey:"links.next"},modal:{loadOnScroll:!0,maxHeight:350,title:a.data("gallery-title"),close_text:a.data("gallery-close"),ok_text:a.data("gallery-add"),selectAll_text:a.data("gallery-select-all"),deselectAll_text:a.data("gallery-deselect-all"),noImageSelected_msg:a.data("gallery-error")}},bragi:{source:{url:a.data("bragi")},buttonLabel:'<i class="fa-brands fa-pied-piper-hat"></i>'},hint:[{match:/\B@(\S*)$/,search:function(t,n){return t.length<3?[]:m(t,n)},template:function(t){return i(t)},content:function(t){return o=!1,u(t)}},{match:/\B\[(\S[^:]*)$/,search:function(t,n){return t.length<3?[]:m(t,n)},template:function(t){return i(t)},content:function(t){return o=!0,u(t)}},{match:/\B\#(\S*)$/,search:function(t,n){return p(t,n)},template:function(t){return i(t)},content:function(t){return o=!1,u(t)}},{match:/\B{(\S[^:]*)$/,search:function(t,n){return C(t,n)},template:function(t){return g(t)},content:function(t){return h(t)}}],keyMap:{pc:{ESC:"escape",ENTER:"insertParagraph","CTRL+Z":"undo","CTRL+Y":"redo",TAB:"tab","SHIFT+TAB":"untab","CTRL+B":"bold","CTRL+I":"italic","CTRL+U":"underline","CTRL+SHIFT+I":"strikethrough","CTRL+BACKSLASH":"removeFormat","CTRL+SHIFT+L":"justifyLeft","CTRL+SHIFT+E":"justifyCenter","CTRL+SHIFT+R":"justifyRight","CTRL+SHIFT+J":"justifyFull","CTRL+SHIFT+NUM7":"insertUnorderedList","CTRL+SHIFT+NUM8":"insertOrderedList","CTRL+LEFTBRACKET":"outdent","CTRL+RIGHTBRACKET":"indent","CTRL+NUM0":"formatPara","CTRL+NUM1":"formatH1","CTRL+NUM2":"formatH2","CTRL+NUM3":"formatH3","CTRL+NUM4":"formatH4","CTRL+NUM5":"formatH5","CTRL+NUM6":"formatH6","CTRL+ENTER":"insertHorizontalRule","CTRL+K":"linkDialog.show"},mac:{ESC:"escape",ENTER:"insertParagraph","CMD+Z":"undo","CMD+SHIFT+Z":"redo",TAB:"tab","SHIFT+TAB":"untab","CMD+B":"bold","CMD+I":"italic","CMD+U":"underline","CMD+SHIFT+I":"strikethrough","CMD+BACKSLASH":"removeFormat","CMD+SHIFT+L":"justifyLeft","CMD+SHIFT+E":"justifyCenter","CMD+SHIFT+R":"justifyRight","CMD+SHIFT+J":"justifyFull","CMD+SHIFT+NUM7":"insertUnorderedList","CMD+SHIFT+NUM8":"insertOrderedList","CMD+LEFTBRACKET":"outdent","CMD+RIGHTBRACKET":"indent","CMD+NUM0":"formatPara","CMD+NUM1":"formatH1","CMD+NUM2":"formatH2","CMD+NUM3":"formatH3","CMD+NUM4":"formatH4","CMD+NUM5":"formatH5","CMD+NUM6":"formatH6","CMD+ENTER":"insertHorizontalRule","CMD+K":"linkDialog.show"}}})};function m(e,t){$.ajax({url:a.data("mention")+"?q="+e+"&new=1",type:"get",dataType:"json",async:!0}).done(t).fail(function(n){n.status===503&&window.showToast(n.responseJSON.message,"toast-error")})}function p(e,t){$.ajax({url:a.data("months")+"?q="+e,type:"get",dataType:"json",async:!0}).done(t)}function C(e,t){if(!a.data("attributes"))return!1;$.ajax({url:a.data("attributes")+"?q="+e,type:"get",dataType:"json",async:!0}).done(t)}function i(e){let t=e.type?" ("+e.type+")":"";return e.image?'<div class="entity-hint">'+e.image+'<div class="entity-hint-name">'+e.fullname+t+"</div></div>":e.fullname+t}function g(e){return e.name+(e.value?" ("+e.value+")":"")}function u(e){if(e.id){let t="["+e.model_type+":"+e.id+e.fullname+"]",n="["+e.model_type+":"+e.id+e.advanced_mention+"]";return e.alias_id?(t="["+e.model_type+":"+e.id+e.advanced_mention+"|alias:"+e.alias_id+e.advanced_mention_alias+"]",$("<span>"+t+"</span>")[0]):a.data("advanced-mention")||o?$("<span>"+n+"</span>")[0]:$("<a />",{text:e.fullname,href:"#",class:"mention","data-name":e.fullname,"data-mention":"["+e.model_type+":"+e.id+"]"})[0]}else{if(e.url)return e.tooltip?$("<a />",{text:e.fullname,href:e.url,title:e.tooltip.replace(/["]/g,"'"),"data-toggle":"tooltip","data-html":"true"})[0]:$("<a />",{text:e.fullname,href:e.url})[0];if(e.inject)return e.inject}return e.fullname}function h(e){return a.data("advanced-mention")?"{attribute:"+e.id+"}":$("<a />",{href:"#",class:"attribute attribute-mention",text:"{"+e.name+"}","data-attribute":"{attribute:"+e.id+"}"})[0]}function T(e){return e?e=="he"?"he-IL":e=="ca"?"ca-ES":e=="el"?"el-GR":e=="en"?"en-US":e+"-"+e.toUpperCase():"en-US"}function y(e,t){let n=$("#campaign-imageupload-modal");if(!a.data("gallery-upload")){n.modal(),console.warn("Campaign isn't superboosted");return}let l=new FormData;l.append("file",t),l.append("_token",$('meta[name="csrf-token"]').attr("content")),$.ajax({url:a.data("gallery-upload"),data:l,cache:!1,contentType:!1,processData:!1,type:"POST",success:function(r){e.summernote("insertImage",r,function(s){s.attr("src",r)})},error:function(r,s,R){let d=$("#campaign-imageupload-error"),f=$("#campaign-imageupload-boosted"),c=$("#campaign-imageupload-permission");d.hide(),f.hide(),c.hide(),r.status===422?d.text(M(r.responseJSON.errors)).show():r.status===403?c.show():f.show(),n.modal()}})}function M(e){var t="";for(let n in e)e.hasOwnProperty(n)&&(t+=e[n]+`
`);return t}
