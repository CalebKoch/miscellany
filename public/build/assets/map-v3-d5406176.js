import{d as v}from"./delete-confirm-fec6aa52.js";var f,k,c,b,m,y,u,l,d,a,s,t;$(document).ready(function(){window.map.invalidateSize(),window.map.on("popupopen",function(e){v()}),$('a[href="#marker-pin"]').click(function(e){$('input[name="shape_id"]').val(1),$("#map-marker-bg-colour").show(),p()}),$('a[href="#marker-label"]').click(function(e){$('input[name="shape_id"]').val(2),$("#map-marker-bg-colour").hide(),p()}),$('a[href="#marker-circle"]').click(function(e){$('input[name="shape_id"]').val(3),$("#map-marker-bg-colour").show(),p()}),$('a[href="#marker-poly"]').click(function(e){$('input[name="shape_id"]').val(5),$("#map-marker-bg-colour").show(),p()}),$('a[href="#presets"]').click(function(e){O($(this).data("presets"))}),$('a[href="#form-markers"]').click(function(e){window.map.invalidateSize()}),D(),_(),E(),N(),T()});function D(){f=$("#map-body"),f.length!==0&&(k=$("#sidebar-map"),c=$("#sidebar-marker"),b=$("#map-marker-modal"),y=$("#map-marker-modal-title"),m=$("#map-marker-modal-content"),window.markerDetails=function(e){x(),window.kankaIsMobile.matches&&(e=e+"?mobile=1"),$.ajax({url:e,type:"GET",async:!0,success:function(n){n&&(window.kankaIsMobile.matches?(y.html(n.name),m.find(".content").html(n.body).show(),m.find(".spinner").hide()):(c.html(n.body).show().parent().find(".spinner").hide(),S(),f.addClass("sidebar-open")),v())}})},M())}function _(){$('select[name="size_id"]').change(function(n){this.value==6?($(".map-marker-circle-helper").hide(),$(".map-marker-circle-radius").show()):($(".map-marker-circle-radius").hide(),$(".map-marker-circle-helper").show())});let e=$("#map-marker-form");$("#entity-form").length===0&&$(".map-marker-edit-form").length===0||(e.unbind("submit").on("submit",function(){window.entityFormHasUnsavedChanges=!1}),M())}function x(){if(window.kankaIsMobile.matches){m.find(".spinner").show(),m.find(".content").hide(),b.modal("toggle");return}f.removeClass("sidebar-collapse").addClass("sidebar-open"),k.hide(),c.html("").show(),c.parent().find(".spinner").show(),C()}function S(){$(".marker-close").click(function(e){c.hide(),k.show()})}function M(){$(".map-legend-marker").click(function(e){e.preventDefault(),window.map.panTo(L.latLng($(this).data("lat"),$(this).data("lng"))),window[$(this).data("id")].openPopup()}),$("a.sidebar-toggle").click(function(){C()})}function C(){setTimeout(()=>{window.map.invalidateSize()},500)}function E(){$(".map-marker-entry-click").click(function(e){e.preventDefault(),$(this).parent().hide(),$(".map-marker-entry-entry").show()})}function T(){$(".btn-mode-enable").click(function(e){e.preventDefault(),window.exploreEditMode=!0,$("body").addClass("map-edit-mode")}),$(".btn-mode-disable").click(function(e){e.preventDefault(),window.exploreEditMode=!1,$("body").removeClass("map-edit-mode")}),$(".btn-mode-drawing").click(function(e){e.preventDefault(),window.drawingPolygon=!1,$("body").removeClass("map-drawing-mode"),$("#marker-modal").modal("show")})}function N(){$("#start-drawing-polygon").on("click",function(e){e.preventDefault(),window.drawingPolygon=!0,window.showToast($(this).data("toast")),$("body").addClass("map-drawing-mode"),$("#marker-modal").modal("hide")}),u=$("#reset-polygon"),u.click(function(e){e.preventDefault(),window.polygon&&window.map.removeLayer(window.polygon),$('textarea[name="custom_shape"]').val(""),u.hide()})}window.addPolygonPosition=function(e,n){let i=$('textarea[name="custom_shape"]'),o=i.val();o.length>0&&(o+=" "),i.val(o+e+","+n);let r=i.val().trim(" ").split(" "),w=[];r.forEach(P=>{let g=P.split(",");w.push([g[0],g[1]])},w),window.polygon&&window.map.removeLayer(window.polygon),j(),window.polygon=L.polygon(w,{weight:l,color:d,opacity:a,fillColor:s,fillOpacity:t,linecap:"round",linejoin:"round"}),window.polygon.addTo(window.map),u.show()};function j(){d=$('input[name="polygon_style[stroke]"]').val(),(!d||d.length<7)&&(d="red"),a=$('input[name="polygon_style[stroke-opacity]"]').val(),isNaN(a)||!a?a=1:a=a/100,s=$('input[name="colour"]').val(),(!s||s.length<7)&&(s="red"),t=$('input[name="opacity"]').val(),isNaN(t)?t=.5:t=t/100,l=$('input[name="polygon_style[stroke-width]"]').val(),(isNaN(l)||!l)&&(l=1)}function p(){$("#marker-main-fields").show(),$("#marker-footer").show()}function O(e){$("#marker-main-fields").hide(),$("#marker-footer").hide(),$(".marker-preset-list .fa-spinner").length!==0&&(console.log("load from",e),$.ajax({url:e}).done(function(n){$(".marker-preset-list").html(n),z()}))}function z(){$(".preset-use").on("click",function(e){e.preventDefault();let n=$(this).data("url");$(this).find(".fa-spin").show(),$.ajax({url:n,context:this}).done(function(i){$(this).find(".fa-spin").hide(),Object.keys(i.preset).forEach(o=>{let h=i.preset[o],r=$('[name="'+o+'"]');if(r.length===0){console.info("markerPreset","unknown field",o);return}o.endsWith("colour")?r.spectrum("set",h):r.val(h)}),$('a[href="#marker-pin"]').click()})})}
