import{_ as y,o as e,c as i,a as l,h as x,e as g,b as o,t as c,n as v,F as h,r as b,k as C,j as A,g as f,f as k,l as D}from"./_plugin-vue_export-helper-0796b9c6.js";import{m as M}from"./mitt-f7ef348c.js";import{v as L}from"./v-click-outside.umd-1708c20a.js";import"./_commonjsHelpers-725317a4.js";const T={props:["ability","permission","meta","trans"],directives:{clickOutside:L.directive},data(){return{details:!1,openedDropdown:!1}},computed:{hasAttribute:function(){return this.ability.attributes.length>0},canDelete:function(){return this.permission},isSelf:function(){return this.meta.user_id===this.ability.created_by},backgroundImage:function(){return this.ability.images.thumb?{backgroundImage:"url("+this.ability.images.thumb+")"}:{}}},methods:{click:function(t){this.details=!this.details},deleteAbility:function(t){this.emitter.emit("delete_ability",t)},updateAbility:function(t){window.openDialog("abilities-dialog",t.actions.edit)},showAbility:function(t){window.open(t.actions.view,"_blank")},setVisibility:function(t){let a={visibility_id:t,ability_id:this.ability.ability_id};axios.patch(this.ability.actions.update,a).then(s=>{this.ability.visibility_id=t,this.emitter.emit("edited_ability",ability)}).catch(()=>{}),this.openedDropdown=!1},useCharge:function(t,a){a>t.used_charges?t.used_charges+=1:t.used_charges-=1,axios.post(t.actions.use,{used:t.used_charges}).then(s=>{s.data.success||(t.used_charges-=1)}).catch(()=>{t.used_charges-=1})},translate(t){return this.trans[t]??"unknown"},dropdownClass(){return this.openedDropdown?"open dropdown":"dropdown"},openDropdown(){this.openedDropdown=!this.openedDropdown},onClickOutside(t){this.openedDropdown=!1}}},H=["data-tags"],j={class:"ability-box p-3 rounded bg-box shadow-xs"},S={class:"ability-header border-b flex items-center gap-2 pb-2 mb-2"},V=["title"],I=["title"],F=["title"],O=["title"],P=["title"],B={key:1,class:"flex gap-2 flex-wrap"},N={key:1,class:"grow"},z=["data-id","data-url"],E=["title"],J=l("i",{class:"fa-solid fa-pencil","aria-hidden":"true"},null,-1),q={class:"sr-only"},G={class:"ability-body entity-content"},K={class:"flex"},Q={class:"flex-1"},R={class:"help-block"},U=["innerHTML"],W=["innerHTML"],X={key:0,class:"flex-none text-right ml-2 mb-2"},Y=["href"],Z={key:0},$={class:"charges relative"},tt=["onClick"],et={key:0,class:"fa-solid fa-chevron-down"},it={key:2},st={class:"dl-horizontal"},nt=["innerHTML"],at={key:1},lt={key:0},ot={key:0,class:"fa-solid fa-check","aria-hidden":"true"},rt=["innerHTML"],dt={key:0,class:"fa-solid fa-chevron-up"};function ct(t,a,s,m,r,n){const _=C("click-outside");return e(),i("div",{class:"ability","data-tags":s.ability.class},[l("div",j,[l("div",S,[s.permission?x((e(),i("div",{key:0,class:g(n.dropdownClass())},[this.openedDropdown?(e(),i("div",B,[l("a",{role:"button",class:"btn2 btn-sm",onClick:a[1]||(a[1]=d=>n.setVisibility(1))},c(n.translate("all")),1),s.meta.is_admin?(e(),i("a",{key:0,role:"button",class:"btn2 btn-sm",onClick:a[2]||(a[2]=d=>n.setVisibility(2))},c(n.translate("admin")),1)):o("",!0),this.isSelf?(e(),i("a",{key:1,role:"button",class:"btn2 btn-sm",onClick:a[3]||(a[3]=d=>n.setVisibility(4))},c(n.translate("self")),1)):o("",!0),this.isSelf?(e(),i("a",{key:2,role:"button",class:"btn2 btn-sm",onClick:a[4]||(a[4]=d=>n.setVisibility(5))},c(n.translate("members")),1)):o("",!0),this.isSelf?(e(),i("a",{key:3,role:"button",class:"btn2 btn-sm",onClick:a[5]||(a[5]=d=>n.setVisibility(3))},c(n.translate("admin-self")),1)):o("",!0)])):(e(),i("a",{key:0,onClick:a[0]||(a[0]=d=>n.openDropdown()),role:"button"},[s.ability.visibility_id===2?(e(),i("i",{key:0,class:"fa-solid fa-lock",title:n.translate("admin")},null,8,V)):o("",!0),s.ability.visibility_id===3?(e(),i("i",{key:1,class:"fa-solid fa-user-lock",title:n.translate("admin-self")},null,8,I)):o("",!0),s.ability.visibility_id===5?(e(),i("i",{key:2,class:"fa-solid fa-users",title:n.translate("members")},null,8,F)):o("",!0),s.ability.visibility_id===4?(e(),i("i",{key:3,class:"fa-solid fa-user-secret",title:n.translate("self")},null,8,O)):o("",!0),s.ability.visibility_id===1?(e(),i("i",{key:4,class:"fa-solid fa-eye",title:n.translate("all")},null,8,P)):o("",!0)]))],2)),[[_,n.onClickOutside]]):o("",!0),this.openedDropdown?o("",!0):(e(),i("div",N,[l("a",{role:"button",onClick:a[6]||(a[6]=d=>n.showAbility(s.ability)),"data-toggle":"tooltip-ajax",class:"grow text-lg","data-id":s.ability.entity.id,"data-url":s.ability.entity.tooltip},c(s.ability.name),9,z)])),this.canDelete&&!this.openedDropdown?(e(),i("a",{key:2,role:"button",onClick:a[7]||(a[7]=d=>n.updateAbility(s.ability)),class:"btn2 btn-ghost btn-xs",title:n.translate("update")},[J,l("span",q,c(n.translate("update")),1)],8,E)):o("",!0)]),l("div",G,[l("div",K,[l("div",Q,[l("span",R,c(s.ability.type),1),l("div",{innerHTML:s.ability.entry},null,8,U),l("div",{innerHTML:s.ability.note,class:"help-block"},null,8,W)]),s.ability.images.has?(e(),i("div",X,[l("a",{class:"ability-image block w-32 h-32 cover-background",target:"_blank",href:s.ability.images.url,style:v(n.backgroundImage)},null,12,Y)])):o("",!0)]),s.ability.charges&&s.permission?(e(),i("div",Z,[l("div",$,[(e(!0),i(h,null,b(s.ability.charges,d=>(e(),i("div",{class:g(["charge inline-block mr-2 h-5 w-5 cursor-pointer bg-white shadow-xs",{used:s.ability.used_charges>=d}]),onClick:w=>n.useCharge(s.ability,d)},null,10,tt))),256))])])):o("",!0),n.hasAttribute?(e(),i("div",{key:1,class:"text-center cursor-pointer",onClick:a[8]||(a[8]=d=>n.click(s.ability))},[r.details?o("",!0):(e(),i("i",et))])):o("",!0),r.details&&n.hasAttribute?(e(),i("div",it,[l("dl",st,[(e(!0),i(h,null,b(s.ability.attributes,d=>(e(),i("div",null,[d.type=="section"?(e(),i("h4",{key:0,class:"font-bold text-center",innerHTML:d.name},null,8,nt)):(e(),i("div",at,[l("dt",null,c(d.name),1),d.type=="checkbox"?(e(),i("dd",lt,[d.value==1?(e(),i("i",ot)):o("",!0)])):(e(),i("dd",{key:1,innerHTML:d.value},null,8,rt))]))]))),256))])])):o("",!0),n.hasAttribute?(e(),i("div",{key:3,class:"text-center cursor-pointer",onClick:a[9]||(a[9]=d=>n.click(s.ability))},[r.details?(e(),i("i",dt)):o("",!0)])):o("",!0)])])],8,H)}const ut=y(T,[["render",ct]]),ht={props:["ability"],data(){return{active:!1}},computed:{backgroundImage:function(){return this.ability.has_image?{backgroundImage:"url("+this.ability.image+")"}:{}}},methods:{click:function(t){this.emitter.emit("click_parent",this.active?null:t)}},mounted(){this.emitter.on("click_parent",t=>{this.active=t&&t.id===this.ability.id})}},bt={class:"ability-name flex justify-center h-full w-full items-center cursor-pointer bg-white/70 hover:bg-black/10 transition-all duration-500"},_t={class:"name text-2xl"};function yt(t,a,s,m,r,n){return e(),i("div",{class:g(["ability-parent cover-background rounded overflow-hidden w-48 h-20",{active:r.active,without:!s.ability.has_image}]),style:v(n.backgroundImage),onClick:a[0]||(a[0]=_=>n.click(s.ability))},[l("div",bt,[l("div",_t,c(s.ability.name),1)])],6)}const mt=y(ht,[["render",yt]]),ft={props:[],data(){return{modal:!1,modalContent:""}},methods:{showModal:function(t){this.modal=!0,axios.get(t).then(a=>{this.modalContent=a.data})},modalStyle:function(){return this.modal?"block":"hidden"}},mounted(){this.emitter.on("add_ability",t=>{this.showModal(t)})}},kt={class:"modal-dialog",role:"document"},gt=["innerHTML"];function vt(t,a,s,m,r,n){return e(),i("div",{class:"modal fade in",style:v({display:this.modalStyle()}),tabindex:"-1",role:"dialog"},[l("div",kt,[l("div",{class:"modal-content",innerHTML:r.modalContent},null,8,gt)])],4)}const pt=y(ft,[["render",vt]]),wt={props:["id","api","permission","trans"],components:{Ability:ut,AbilityForm:pt,Parent:mt},data(){return{abilities:[],parents:[],meta:[],loading:!0,show_parent:!1,parent:null,waiting:!1,modal:!1,json_trans:[]}},methods:{getAbilities:function(){fetch(this.api).then(t=>t.json()).then(t=>{this.abilities=t.data.abilities,this.parents=t.data.parents,this.meta=t.data.meta,this.loading=!1,this.waiting=!1,this.parent&&(this.parent=this.parents[this.parent.id],this.showParent(this.parent))})},showParent:function(t){this.show_parent=!!t},addAbility:function(){this.emitter.emit("add_ability",this.meta.add_url)},deleteAbility:function(t){this.waiting=!0,axios.delete(t.actions.delete).then(()=>{this.getAbilities()}).catch(()=>{this.getAbilities()})},translate(t){return this.json_trans[t]??"unknown"}},mounted(){this.getAbilities(),this.emitter.on("click_parent",t=>{this.parent=t,this.showParent(t)}),this.emitter.on("delete_ability",t=>{this.deleteAbility(t)}),this.json_trans=JSON.parse(this.trans)},updated(){window.ajaxTooltip()}},xt={class:"viewport box-abilities relative flex flex-col gap-5"},Ct={key:0,class:"load more text-center"},At=l("i",{class:"fa-solid fa-spin fa-spinner"},null,-1),Dt=[At],Mt={class:"flex gap-5 flex-wrap"},Lt={key:1,class:"flex flex-col gap-5"},Tt={key:0,class:"parent-box p-3 rounded bg-box shadow-xs"},Ht={class:"parent-header mb-2"},jt=["href"],St=["innerHTML"],Vt={class:"flex flex-col gap-5"},It={key:2,class:"box-waiting absolute top-0 w-full h-full bg-black/20 text-center"},Ft=l("i",{class:"fa-solid fa-spin fa-spinner fa-4x mt-5"},null,-1),Ot=[Ft];function Pt(t,a,s,m,r,n){const _=f("parent"),d=f("ability"),w=f("AbilityForm");return e(),i("div",xt,[r.loading?(e(),i("div",Ct,Dt)):o("",!0),l("div",Mt,[(e(!0),i(h,null,b(r.parents,u=>(e(),k(_,{key:u.id,ability:u},null,8,["ability"]))),128))]),r.show_parent?(e(),i("div",Lt,[r.parent.entry?(e(),i("div",Tt,[l("div",Ht,[l("a",{class:"text-lg",href:r.parent.url},c(r.parent.name),9,jt)]),l("div",{class:"entity-content parent-body",innerHTML:r.parent.entry},null,8,St)])):o("",!0),(e(!0),i(h,null,b(r.parent.abilities,u=>(e(),k(d,{key:u.id,ability:u,permission:s.permission,meta:r.meta,trans:r.json_trans},null,8,["ability","permission","meta","trans"]))),128))])):o("",!0),l("div",Vt,[r.show_parent?o("",!0):(e(!0),i(h,{key:0},b(r.abilities,u=>(e(),k(d,{key:u.id,ability:u,permission:s.permission,meta:r.meta,trans:r.json_trans},null,8,["ability","permission","meta","trans"]))),128))]),A(w,{trans:r.json_trans},null,8,["trans"]),r.waiting?(e(),i("div",It,Ot)):o("",!0)])}const Bt=y(wt,[["render",Pt]]),Nt=M(),p=D({});p.config.globalProperties.emitter=Nt;p.component("abilities",Bt);p.mount("#abilities");
